{% extends "base.html" %}

{% block content %}
    {% if play_sound %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const audio = new Audio("{{ url_for('static', filename='sounds/mcdonalds-jingle.mp3') }}");
            audio.volume = 1.0;
            audio.play().then(() => {
                console.log("‚úÖ Sound played!");
            }).catch(err => {
                console.warn("‚ö†Ô∏è Autoplay blocked:", err);
            });
        });
    </script>
    {% endif %}
    <h1>Welcome to Meal Sharing App</h1>
    
    <h2>Active Group Orders</h2>
    {% if active_orders %}
        <div class="orders-list">
            {% for order in active_orders %}
                <div class="order-card">
                    <h3>Order from {{ order.restaurant.name }}</h3>
                    <p>Created by: {{ order.creator.username }}</p>
                    <p>Delivery at: {{ order.order_time.strftime('%Y-%m-%d %H:%M') }}</p>
                    <p>Participants: {{ order.participants|length }}</p>
                    <a href="{{ url_for('order_details', order_id=order.id) }}" class="btn">View Details</a>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No active orders at the moment. Why not <a href="{{ url_for('create_order') }}">create one</a>?</p>
    {% endif %}
    
    <div style="margin-bottom: 20px;">
        <a href="{{ url_for('input_preference') }}" class="btn btn-secondary">üéØ Enter Your Preferences</a>
    </div>

    <h2>Your Top MealMate Matches</h2>
    {% if matches %}
        <ul class="match-list">
            {% for match, score in matches %}
                <li>
                    <strong>{{ match.school_id }}</strong> ‚Äì
                    Similarity: {{ '%.2f'|format(score) }}<br>
                    Location: {{ match.location }}<br>
                    Eats at: {{ match.eat_time }}<br>
                    Restrictions: {{ match.dietary_restrictions }}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No matches found. Click above to add your preferences!</p>
    {% endif %}
{% endblock %}